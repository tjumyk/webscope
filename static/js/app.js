// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('app', []).controller('rootController', [
    '$scope', '$http', function($scope, $http) {
      var formatResponseError;
      $scope.getPanelClass = function(site) {
        var status;
        status = site.status_code;
        if (status === 200) {
          return 'panel-default';
        }
        if (status >= 500) {
          return 'panel-error';
        }
        return 'panel-warning';
      };
      formatResponseError = function(response) {
        if (!!response.data && !!response.data.error) {
          return response.data.error;
        } else if (response.status === -1) {
          return "Connection failed";
        } else {
          return '[' + response.status + '] ' + response.statusText;
        }
      };
      $scope.load_servers = function() {
        $scope.loading = true;
        $scope.servers = [];
        $scope.last_scan = void 0;
        return $http.get('/api/servers').then(function(response) {
          var data;
          $scope.loading = false;
          data = response.data;
          $scope.servers = data.servers;
          if (data.last_scan) {
            return $scope.last_scan = moment.utc(data.last_scan).fromNow();
          }
        }, function(response) {
          $scope.loading = false;
          return alert(formatResponseError(response));
        });
      };
      $scope.rescan = function() {
        $scope.scanning = true;
        return $http.get('/api/scan').then(function(response) {
          $scope.scanning = false;
          return $scope.load_servers();
        }, function(response) {
          $scope.scanning = false;
          return alert(formatResponseError(response));
        });
      };
      return $scope.load_servers();
    }
  ]);

}).call(this);

//# sourceMappingURL=app.js.map
